/*
 * Swipe 2.0
 *
 * Brad Birdsall
 * Copyright 2013, MIT License
 *
*/

function Swipe(t,n){"use strict";function e(){h=E.children,w=Array(h.length),m=t.getBoundingClientRect().width||t.offsetWidth,E.style.width=h.length*m+"px";for(var n=h.length;n--;){var e=h[n];e.style.width=m+"px",e.setAttribute("data-index",n),f.transitions&&(e.style.left=n*-m+"px",o(n,x>n?-m:n>x?m:0,0))}f.transitions||(E.style.left=x*-m+"px"),t.style.visibility="visible"}function i(){x?a(x-1):n.continuous&&a(h.length-1)}function r(){h.length-1>x?a(x+1):n.continuous&&a(0)}function a(t,e){var i=-1;if("number"==typeof t)i=t;else if("string"==typeof t)for(var r=0;h.length>r;++r){var a=h[r];if(a.id===t){i=r;break}}else{if(!(t instanceof Element))throw"Invalid target type.";for(var r=0;h.length>r;++r){var a=h[r];if(a.id==id){i=r;break}}}if(-1==i||i==x)return!1;if(f.transitions){for(var s=Math.abs(x-i)-1,c=Math.abs(x-i)/(x-i);s--;)o((i>x?i:x)-s-1,m*c,0);o(x,m*c,e||y),o(i,0,e||y)}else d(x*-m,i*-m,e||y);return x=i,v(n.callback&&n.callback(x,h[x])),!0}function o(t,n,e){s(t,n,e),w[t]=n}function s(t,n,e){var i=h[t],r=i&&i.style;r&&(r.webkitTransitionDuration=r.MozTransitionDuration=r.msTransitionDuration=r.OTransitionDuration=r.transitionDuration=e+"ms",r.webkitTransform="translate("+n+"px,0)"+"translateZ(0)",r.msTransform=r.MozTransform=r.OTransform="translateX("+n+"px)")}function d(t,e,i){if(!i)return E.style.left=e+"px",void 0;var r=+new Date,a=setInterval(function(){var o=+new Date-r;return o>i?(E.style.left=e+"px",T&&c(),n.transitionEnd&&n.transitionEnd.call(event,x,h[x]),clearInterval(a),void 0):(E.style.left=(e-t)*(Math.floor(100*(o/i))/100)+t+"px",void 0)},4)}function c(){p=setTimeout(r,T)}function u(){T=0,clearTimeout(p)}var l=function(){},v=function(t){setTimeout(t||l,0)},f={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(t){var n=["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"];for(var e in n)if(void 0!==t.style[n[e]])return!0;return!1}(document.createElement("swipe"))};if(t){var h,w,m,E=t.children[0];n=n||{};var p,b,x=parseInt(n.startSlide,10)||0,y=n.speed||300,T=n.auto||0,g={},L={},k={handleEvent:function(t){switch(t.type){case"touchstart":this.start(t);break;case"touchmove":this.move(t);break;case"touchend":v(this.end(t));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":v(this.transitionEnd(t));break;case"resize":v(e.call())}n.stopPropagation&&t.stopPropagation()},start:function(t){var n=t.touches[0];g={x:n.pageX,y:n.pageY,time:+new Date},b=void 0,L={},E.addEventListener("touchmove",this,!1),E.addEventListener("touchend",this,!1)},move:function(t){if(!(t.touches.length>1||t.scale&&1!==t.scale)){n.disableScroll&&t.preventDefault();var e=t.touches[0];L={x:e.pageX-g.x,y:e.pageY-g.y},b===void 0&&(b=!!(b||Math.abs(L.x)<Math.abs(L.y))),b||(t.preventDefault(),u(),L.x=L.x/(!x&&L.x>0||x==h.length-1&&0>L.x?Math.abs(L.x)/m+1:1),s(x-1,L.x+w[x-1],0),s(x,L.x+w[x],0),s(x+1,L.x+w[x+1],0))}},end:function(){var t=+new Date-g.time,e=250>Number(t)&&Math.abs(L.x)>20||Math.abs(L.x)>m/2,i=!x&&L.x>0||x==h.length-1&&0>L.x,r=0>L.x;b||(e&&!i?(r?(o(x-1,-m,0),o(x,w[x]-m,y),o(x+1,w[x+1]-m,y),x+=1):(o(x+1,m,0),o(x,w[x]+m,y),o(x-1,w[x-1]+m,y),x+=-1),n.callback&&n.callback(x,h[x])):(o(x-1,-m,y),o(x,0,y),o(x+1,m,y))),E.removeEventListener("touchmove",k,!1),E.removeEventListener("touchend",k,!1)},transitionEnd:function(t){parseInt(t.target.getAttribute("data-index"),10)==x&&(T&&c(),n.transitionEnd&&n.transitionEnd.call(t,x,h[x]))}};return e(),T&&c(),f.addEventListener?(f.touch&&E.addEventListener("touchstart",k,!1),f.transitions&&(E.addEventListener("webkitTransitionEnd",k,!1),E.addEventListener("msTransitionEnd",k,!1),E.addEventListener("oTransitionEnd",k,!1),E.addEventListener("otransitionend",k,!1),E.addEventListener("transitionend",k,!1)),window.addEventListener("resize",k,!1)):window.onresize=function(){e()},{setup:function(){e()},slide:function(t,n){a(t,n)},prev:function(){u(),i()},next:function(){u(),r()},getPos:function(){return x},kill:function(){u(),E.style.width="auto",E.style.left=0;for(var t=h.length;t--;){var n=h[t];n.style.width="100%",n.style.left=0,f.transitions&&s(t,0,0)}f.addEventListener?(E.removeEventListener("touchstart",k,!1),E.removeEventListener("webkitTransitionEnd",k,!1),E.removeEventListener("msTransitionEnd",k,!1),E.removeEventListener("oTransitionEnd",k,!1),E.removeEventListener("otransitionend",k,!1),E.removeEventListener("transitionend",k,!1),window.removeEventListener("resize",k,!1)):window.onresize=null}}}}(window.jQuery||window.Zepto)&&function(t){t.fn.Swipe=function(n){return this.each(function(){t(this).data("Swipe",new Swipe(t(this)[0],n))})}}(window.jQuery||window.Zepto);
