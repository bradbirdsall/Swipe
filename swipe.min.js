/*
 * Swipe 2.0
 *
 * Brad Birdsall
 * Copyright 2013, MIT License
 *
*/

function Swipe(t,e){"use strict";function n(){m=p.children,w=Array(m.length),E=t.getBoundingClientRect().width||t.offsetWidth,p.style.width=m.length*E+"px";for(var e=m.length;e--;){var n=m[e];n.style.width=E+"px",n.setAttribute("data-index",e),h.transitions&&(n.style.left=e*-E+"px",r(e,T>e?-E:e>T?E:0,0))}h.transitions||(p.style.left=T*-E+"px"),t.style.visibility="visible"}function i(){T?o(T-1):e.continuous&&o(m.length-1),e.events&&e.events.emit("prev",u)}function s(){m.length-1>T?o(T+1):e.continuous&&o(0),e.events&&e.events.emit("next",u)}function o(t,n){if(T!=t){if(h.transitions){for(var i=Math.abs(T-t)-1,s=Math.abs(T-t)/(T-t);i--;)r((t>T?t:T)-i-1,E*s,0);r(T,E*s,n||y),r(t,0,n||y)}else d(T*-E,t*-E,n||y);T=t,f(e.callback&&e.callback(T,m[T])),e.events&&e.events.emit("slide",u,T,m[T])}}function r(t,e,n){a(t,e,n),w[t]=e}function a(t,e,n){var i=m[t],s=i&&i.style;s&&(s.webkitTransitionDuration=s.MozTransitionDuration=s.msTransitionDuration=s.OTransitionDuration=s.transitionDuration=n+"ms",s.webkitTransform="translate("+e+"px,0)"+"translateZ(0)",s.msTransform=s.MozTransform=s.OTransform="translateX("+e+"px)")}function d(t,n,i){if(!i)return p.style.left=n+"px",void 0;var s=+new Date,o=setInterval(function(){var r=+new Date-s;return r>i?(p.style.left=n+"px",L&&v(),e.transitionEnd&&e.transitionEnd.call(event,T,m[T]),e.events&&e.events.emit("transitionEnd",u,T,m[T]),clearInterval(o),void 0):(p.style.left=(n-t)*(Math.floor(100*(r/i))/100)+t+"px",void 0)},4)}function v(){x=setTimeout(s,L),e.events&&e.events.emit("begin",u)}function c(){L=0,clearTimeout(x),e.events&&e.events.emit("stop",u)}var u=this,l=function(){},f=function(t){setTimeout(t||l,0)},h={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(t){var e=["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"];for(var n in e)if(void 0!==t.style[e[n]])return!0;return!1}(document.createElement("swipe"))};if(t){var m,w,E,p=t.children[0];e=e||{};var x,b,T=parseInt(e.startSlide,10)||0,y=e.speed||300,L=e.auto||0,g={},k={},D={handleEvent:function(t){switch(t.type){case"touchstart":this.start(t);break;case"touchmove":this.move(t);break;case"touchend":f(this.end(t));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":f(this.transitionEnd(t));break;case"resize":f(n.call())}e.stopPropagation&&t.stopPropagation()},start:function(t){var e=t.touches[0];g={x:e.pageX,y:e.pageY,time:+new Date},b=void 0,k={},p.addEventListener("touchmove",this,!1),p.addEventListener("touchend",this,!1)},move:function(t){if(!(t.touches.length>1||t.scale&&1!==t.scale)){e.disableScroll&&t.preventDefault();var n=t.touches[0];k={x:n.pageX-g.x,y:n.pageY-g.y},b===void 0&&(b=!!(b||Math.abs(k.x)<Math.abs(k.y))),b||(t.preventDefault(),c(),k.x=k.x/(!T&&k.x>0||T==m.length-1&&0>k.x?Math.abs(k.x)/E+1:1),a(T-1,k.x+w[T-1],0),a(T,k.x+w[T],0),a(T+1,k.x+w[T+1],0))}},end:function(){var t=+new Date-g.time,n=250>Number(t)&&Math.abs(k.x)>20||Math.abs(k.x)>E/2,i=!T&&k.x>0||T==m.length-1&&0>k.x,s=0>k.x;b||(n&&!i?(s?(r(T-1,-E,0),r(T,w[T]-E,y),r(T+1,w[T+1]-E,y),T+=1):(r(T+1,E,0),r(T,w[T]+E,y),r(T-1,w[T-1]+E,y),T+=-1),e.callback&&e.callback(T,m[T]),e.events&&e.events.emit("slide",u,T,m[T])):(r(T-1,-E,y),r(T,0,y),r(T+1,E,y))),p.removeEventListener("touchmove",D,!1),p.removeEventListener("touchend",D,!1)},transitionEnd:function(t){parseInt(t.target.getAttribute("data-index"),10)==T&&(L&&v(),e.transitionEnd&&e.transitionEnd.call(t,T,m[T]),e.events&&e.events.emit("transitionEnd",u,T,m[T]))}};return n(),L&&v(),h.addEventListener?(h.touch&&p.addEventListener("touchstart",D,!1),h.transitions&&(p.addEventListener("webkitTransitionEnd",D,!1),p.addEventListener("msTransitionEnd",D,!1),p.addEventListener("oTransitionEnd",D,!1),p.addEventListener("otransitionend",D,!1),p.addEventListener("transitionend",D,!1)),window.addEventListener("resize",D,!1)):window.onresize=function(){n()},{setup:n,slide:o,prev:function(){c(),i()},next:function(){c(),s()},getPos:function(){return T},kill:function(){c(),p.style.width="auto",p.style.left=0;for(var t=m.length;t--;){var e=m[t];e.style.width="100%",e.style.left=0,h.transitions&&a(t,0,0)}h.addEventListener?(p.removeEventListener("touchstart",D,!1),p.removeEventListener("webkitTransitionEnd",D,!1),p.removeEventListener("msTransitionEnd",D,!1),p.removeEventListener("oTransitionEnd",D,!1),p.removeEventListener("otransitionend",D,!1),p.removeEventListener("transitionend",D,!1),window.removeEventListener("resize",D,!1)):window.onresize=null}}}}(window.jQuery||window.Zepto)&&function(t){t.fn.Swipe=function(e){return this.each(function(){t(this).data("Swipe",new Swipe(t(this)[0],e))})}}(window.jQuery||window.Zepto);
